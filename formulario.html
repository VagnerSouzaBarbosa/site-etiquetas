<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Falhas de Etiquetas ‚Äì Lote X</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.emailjs.com/sdk/3.2.0/email.min.js"></script>
  <style>
    :root {
      --bg: #001f3f;
      --card-bg: #fff;
      --accent: #00aaff;
      --text-light: #fff;
      --text-dark: #003366;
      --radius: 8px;
      --transition: .3s ease;
    }
    * { box-sizing: border-box; margin:0; padding:0 }
    body {
      background: var(--bg);
      font-family: 'Orbitron',sans-serif;
      color: var(--text-dark);
      display: flex;
      justify-content: center;
      padding: 1rem;
    }
    .card {
      background: var(--card-bg);
      border-radius: var(--radius);
      width: 100%; max-width: 800px;
      box-shadow: 0 4px 20px rgba(0,0,0,.2);
      overflow: hidden;
      animation: fadeIn .8s ease-out;
    }
    @keyframes fadeIn {
      from { opacity:0; transform:translateY(20px) }
      to   { opacity:1; transform:translateY(0) }
    }
    .header {
      background: var(--accent);
      color: var(--text-light);
      display: flex; align-items: center; gap:1rem;
      padding: 1rem;
    }
    .header img { width:80px; }
    .header h1 { font-size:1.6rem }
    .body { padding:1.5rem }
    form label {
      display:block; margin-top:1rem;
      font-weight:700; font-size:.95rem;
      text-align:left;
    }
    form input, form select, form textarea {
      width:100%; padding:.7rem; margin-top:.3rem;
      border:1px solid #ccc; border-radius:var(--radius);
      font-size:.95rem;
      transition: border var(--transition), box-shadow var(--transition);
    }
    form input:focus, form select:focus, form textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 8px rgba(0,170,255,.4);
      outline: none;
    }
    .actions { margin-top:1.5rem; text-align:center }
    .actions button {
      background:var(--accent);
      color:var(--text-light);
      border:none;
      padding:.75rem 2rem;
      font-size:1rem;
      border-radius:var(--radius);
      cursor:pointer;
      transition: background var(--transition);
    }
    .actions button:hover { background:#33ccff }
    .charts {
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:2rem;
      margin-top:2rem;
    }
    canvas {
      background:#fafafa;
      border-radius:var(--radius);
    }
    .checklist {
      margin-top:2rem;
      background:#f9f9f9;
      padding:1rem;
      border-radius:var(--radius);
    }
    .checklist h3 { text-align:center; margin-bottom:.5rem }
    #checklist-container {
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:.5rem 1rem;
      max-height:250px;
      overflow-y:auto;
      padding:.5rem;
      background:#fff;
      border:1px solid #ddd;
      border-radius:var(--radius);
    }
    #checklist-container label {
      display:flex; align-items:center; gap:.5rem;
      font-size:.9rem;
    }
    #counters {
      margin-top:2rem;
      text-align:center;
      font-size:1rem;
      font-weight:700;
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="header">
      <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRAdRZj6UwfwUFfvlmCfFUDzQMDJz7YZioF_de0F8SLA5yHB8dxPEFCCUgEDGW4ERl8-fI&usqp=CAU"
           alt="Logo Roseanne Dore">
      <h1>Falhas de Etiquetas ‚Äì Lote X</h1>
    </div>
    <div class="body">
      <!-- formul√°rio -->
      <form id="feedForm">
        <label for="data">üìÖ Data da Ocorr√™ncia</label>
        <input type="date" id="data" name="data" required>

        <label for="unidade">üè¢ Unidade</label>
        <select id="unidade" name="unidade" required>
          <option value="" disabled selected>Selecione a unidade</option>
          <option>ALTIPLANO</option><option>BAIRRO DOS ESTADOS</option>
          <option>BANCARIOS</option><option>BAYEUX</option>
          <option>BESSA</option><option>BESSA II</option>
          <option>CABEDELO</option><option>CRISTO REDENTOR</option>
          <option>CRUZ DAS ARMAS</option><option>EPIT√ÅCIO</option>
          <option>GEISEL</option><option>GUARABIRA</option>
          <option>INTERMARES</option><option>MAMANGUAPE</option>
          <option>MANA√çRA</option><option>MANGABEIRA</option>
          <option>NOVA DIAGN√ìSTICO</option><option>PATOS</option>
          <option>SANTA RITA</option><option>SAP√â</option>
          <option>SAP√â II</option><option>TAMB√ÅU</option>
          <option>TORRE</option><option>VALENTINA</option>
          <option>COLETADOMICILIAR</option>
        </select>

        <label for="quantidade">üî¢ Quantidade de Falhas</label>
        <input type="number" id="quantidade" name="quantidade" min="1" required>

        <label for="comentario">‚úèÔ∏è Descri√ß√£o / Coment√°rio</label>
        <textarea id="comentario" name="comentario" rows="3" required
                  placeholder="Ex.: Descolou na lateral esquerda do tubo"></textarea>

        <label for="responsavel">üñãÔ∏è Respons√°vel pelo Registro</label>
        <input type="text" id="responsavel" name="responsavel" required placeholder="Nome completo">

        <label for="foto">üì∑ Foto da Falha</label>
        <input type="file" id="foto" name="foto" accept="image/*" required>

        <div class="actions">
          <button type="submit">Enviar Feedback</button>
        </div>
      </form>

      <!-- gr√°ficos -->
      <div class="charts">
        <div>
          <h3 style="text-align:center">Respostas por Unidade</h3>
          <canvas id="reportChart" height="200"></canvas>
        </div>
        <div>
          <h3 style="text-align:center">Total de Visitantes</h3>
          <canvas id="visitorChart" height="200"></canvas>
        </div>
      </div>

      <!-- checklist -->
      <div class="checklist">
        <h3>Checklist de Unidades Respondidas</h3>
        <div id="checklist-container">
          <label><input type="checkbox" data-unit="ALTIPLANO"> ALTIPLANO</label>
          <label><input type="checkbox" data-unit="BAIRRO DOS ESTADOS"> BAIRRO DOS ESTADOS</label>
          <label><input type="checkbox" data-unit="BANCARIOS"> BANCARIOS</label>
          <label><input type="checkbox" data-unit="BAYEUX"> BAYEUX</label>
          <label><input type="checkbox" data-unit="BESSA"> BESSA</label>
          <label><input type="checkbox" data-unit="BESSA II"> BESSA II</label>
          <label><input type="checkbox" data-unit="CABEDELO"> CABEDELO</label>
          <label><input type="checkbox" data-unit="CRISTO REDENTOR"> CRISTO REDENTOR</label>
          <label><input type="checkbox" data-unit="CRUZ DAS ARMAS"> CRUZ DAS ARMAS</label>
          <label><input type="checkbox" data-unit="EPIT√ÅCIO"> EPIT√ÅCIO</label>
          <label><input type="checkbox" data-unit="GEISEL"> GEISEL</label>
          <label><input type="checkbox" data-unit="GUARABIRA"> GUARABIRA</label>
          <label><input type="checkbox" data-unit="INTERMARES"> INTERMARES</label>
          <label><input type="checkbox" data-unit="MAMANGUAPE"> MAMANGUAPE</label>
          <label><input type="checkbox" data-unit="MANA√çRA"> MANA√çRA</label>
          <label><input type="checkbox" data-unit="MANGABEIRA"> MANGABEIRA</label>
          <label><input type="checkbox" data-unit="NOVA DIAGN√ìSTICO"> NOVA DIAGN√ìSTICO</label>
          <label><input type="checkbox" data-unit="PATOS"> PATOS</label>
          <label><input type="checkbox" data-unit="SANTA RITA"> SANTA RITA</label>
          <label><input type="checkbox" data-unit="SAP√â"> SAP√â</label>
          <label><input type="checkbox" data-unit="SAP√â II"> SAP√â II</label>
          <label><input type="checkbox" data-unit="TAMB√ÅU"> TAMB√ÅU</label>
          <label><input type="checkbox" data-unit="TORRE"> TORRE</label>
          <label><input type="checkbox" data-unit="VALENTINA"> VALENTINA</label>
          <label><input type="checkbox" data-unit="COLETADOMICILIAR"> COLETADOMICILIAR</label>
        </div>
      </div>

      <!-- counters no final -->
      <div id="counters">
        <p id="visitor-count">Visitantes: 0</p>
        <p id="checklist-count">Unidades marcadas: 0 / 25</p>
      </div>
    </div>
  </div>

  <script>
    emailjs.init('YOUR_USER_ID');
    const STORAGE_KEY = 'etiquetas_feedbacks';
    const VISITOR_KEY = 'site_visitors';
    const CHECK_KEY   = 'unit_checklist';

    // incrementa visita
    function incrementVisitor() {
      const c = parseInt(localStorage.getItem(VISITOR_KEY)||'0',10) + 1;
      localStorage.setItem(VISITOR_KEY, c);
      return c;
    }
    // atualiza gr√°ficos
    function drawCharts() {
      // visitantes
      const visitors = parseInt(localStorage.getItem(VISITOR_KEY)||'0',10);
      document.getElementById('visitor-count').textContent = `Visitantes: ${visitors}`;
      new Chart(document.getElementById('visitorChart'), {
        type: 'bar',
        data: { labels:['Visitantes'], datasets:[{ label:'Total', data:[visitors], backgroundColor:'rgba(255,170,0,0.6)' }]},
        options:{ scales:{ y:{ beginAtZero:true } } }
      });
      // respostas por unidade
      const all = JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]');
      const counts = all.reduce((m,r)=>{ m[r.unidade]=(m[r.unidade]||0)+1; return m; },{});
      new Chart(document.getElementById('reportChart'), {
        type:'bar',
        data:{ labels:Object.keys(counts), datasets:[{ label:'Respostas', data:Object.values(counts), backgroundColor:'rgba(0,170,255,0.6)' }]},
        options:{ scales:{ y:{ beginAtZero:true } } }
      });
    }
    // atualiza checklist visual e contador
    function updateChecklist() {
      const states = JSON.parse(localStorage.getItem(CHECK_KEY)||'{}');
      let checked = 0;
      document.querySelectorAll('#checklist-container input').forEach(cb=>{
        const unit = cb.dataset.unit;
        cb.checked = !!states[unit];
        if(cb.checked) checked++;
      });
      document.getElementById('checklist-count').textContent = `Unidades marcadas: ${checked} / 25